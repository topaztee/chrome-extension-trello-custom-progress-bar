chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  // if checklist id present then a request.greeting will be sent from background
    if (request.greeting == "hello") {
      // sendResponse({farewell: "goodbye"});
      if (document.getElementsByClassName('checklist-progress-bar-current js-checklist-progress-bar').length) {
        checklist = document.getElementsByClassName('checklist-progress-bar');
        checklist[0].style["height"] = '30px';
        updatePage();
      }
    }
});

function updatePage(){
  checklistElem = document.getElementsByClassName('checklist-progress-bar-current js-checklist-progress-bar');
  checklist = document.getElementsByClassName('checklist-progress-bar');
  chrome.storage.sync.get({userChoice: 'rainbow'}, function(settings) {
    if ('rainbow' === settings.userChoice) {
      checklist[0].style["height"] = '10px';
      checklistElem[0].style["background"] = 'linear-gradient(to right, #b827fc 0%, #2c90fc 25%, #b8fd33 50%, #fec837 75%, #fd1892 100%)';
    } else if ('coin' === settings.userChoice) {
      checklist[0].style["height"] = '30px';
      checklistElem[0].style["background"] = "url('data:image/png;base64,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')";
    }
    else {
      checklist[0].style["height"] = '30px';
      checklistElem[0].style["background"] = "url('data:image/png;base64,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')";
    }
  });
}
chrome.storage.onChanged.addListener(updatePage);
updatePage();


